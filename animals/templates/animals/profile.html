{% extends "base.html" %}

{% block content %}
<h2>Animal Profile</h2>
<img src="{{ animal.image.url }}" alt="Image of {{ animal.name }}" style="width:200px; height:auto;">
<p><strong>Shelter:</strong> {{ animal.shelter }}</p>
<p><strong>Name:</strong> {{ animal.name }}</p>
<p><strong>Species:</strong> {{ animal.species }}</p>
<p><strong>Breed:</strong> {{ animal.breed }}</p>
<p><strong>Age:</strong> {{ animal.age }}</p>
<p><strong>Description:</strong> {{ animal.description }}</p>
<p><strong>Foster status:</strong> {{ animal.adoption_status }}</p>

{% if user == animal.shelter.admin %}
<a href="{% url 'edit_animal_profile' animal.id %}">Edit Profile</a>
<a href="#" data-bs-toggle="modal" data-bs-target="#deleteModal{{ animal.id }}">Delete Profile</a>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal{{ animal.id }}" tabindex="-1" aria-labelledby="deleteModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteModalLabel">Are you sure?</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Changes cannot be undone!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="{% url 'delete_animal_profile' animal.id %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-secondary">Delete Profile</button>
        </form>
      </div>
    </div>
  </div>
</div>

<a href="{% url 'add_update' animal.id %}">Add Update</a>

{% endif %}

<a href="{% url 'select_sprite' animal.id %}">Foster</a>

<h2>Updates</h2>
<ul>
  {% for update in animal.updates.all %}
  <li>{{ update.created_at|date:"Y-m-d H:i" }}: {{ update.text }}
    {% if user == animal.shelter.admin %}
    <a href="{% url 'edit_update' update.id %}">Edit Update</a>
    <a href="#" data-bs-toggle="modal" data-bs-target="#deleteUpdateModal{{ update.id }}">Delete Update</a>
    <!-- Delete Modal -->
    <div class="modal fade" id="deleteUpdateModal{{ update.id }}" tabindex="-1" aria-labelledby="deleteModalLabel"
      aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="deleteModalLabel">Are you sure?</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>Changes cannot be undone!</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <form action="{% url 'delete_update' update.id %}" method="POST">
              {% csrf_token %}
              <button type="submit" class="btn btn-secondary">Confirm</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </li>
  {% empty %}
  <li>No updates yet.</li>
  {% endfor %}
</ul>

{% endblock %}